{% extends 'base.html' %}

{% block content %}
<div class="container">
  <h2>Downloads</h2>
  <table class="table">
    <thead>
      <tr>
        <th>File Name</th>
        <th>Status</th>
        <th>Downloaded At</th>
      </tr>
    </thead>
    <tbody>
      {% for download in downloads %}
      <tr>
        <td>{{ download.file.name }}</td>
        <td>
          <div id="status-{{ download.pk }}"></div>
          <script>
            function updateDownloadStatus{{ download.pk }}() {
              $.ajax({
                url: "{% url 'download_status' download.pk %}",
                success: function(data) {
                  $("#status-{{ download.pk }}").text(data.status);
                }
              });
            }
            setInterval(updateDownloadStatus{{ download.pk }}, 3000);
          </script>
        </td>
        <td>{{ download.downloaded_at|date:"SHORT_DATETIME_FORMAT" }}</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% endblock %}
